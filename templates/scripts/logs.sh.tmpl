#!/bin/bash
set -euo pipefail

BASE_DIR="${MEMPOOL_BASE_DIR}"
NETWORK_LIST="${MEMPOOL_NETWORKS}"

IFS=',' read -r -a ALL_NETWORKS <<<"$NETWORK_LIST"
if [[ ${#ALL_NETWORKS[@]} -eq 0 || -z "${ALL_NETWORKS[0]}" ]]; then
    echo "No networks configured. Edit config/mempool-stack.conf and run sudo make deploy."
    exit 1
fi

network="${1:-${ALL_NETWORKS[0]}}"
service="${2:-}"
compose="${BASE_DIR}/${network}/docker-compose.yml"

if [[ ! -f "$compose" ]]; then
    echo "Unknown network '${network}'. Available: ${ALL_NETWORKS[*]}"
    exit 1
fi

if [[ -n "$service" ]]; then
    docker compose -f "$compose" logs -f "$service"
else
    docker compose -f "$compose" logs -f
fi
