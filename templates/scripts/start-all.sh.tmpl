#!/bin/bash
set -euo pipefail

BASE_DIR="${MEMPOOL_BASE_DIR}"
NETWORK_LIST="${MEMPOOL_NETWORKS}"

IFS=',' read -r -a ALL_NETWORKS <<<"$NETWORK_LIST"
if [[ ${#ALL_NETWORKS[@]} -eq 0 || -z "${ALL_NETWORKS[0]}" ]]; then
    echo "No networks configured. Edit config/mempool-stack.conf and run sudo make deploy."
    exit 1
fi

for network in "${ALL_NETWORKS[@]}"; do
    dir="${BASE_DIR}/${network}"
    compose="${dir}/docker-compose.yml"
    if [[ ! -f "$compose" ]]; then
        echo "Skipping unknown network '${network}'."
        continue
    fi
    echo "Starting ${network}"
    (cd "$dir" && docker compose up -d)
done
